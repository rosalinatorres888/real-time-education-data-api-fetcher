<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Education Performance Dashboard | Stakeholder Presentation</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            color: #333;
        }
        
        /* Navigation */
        .nav-header {
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
            list-style: none;
        }
        
        .nav-links a {
            color: #555;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .nav-links a:hover {
            color: #667eea;
        }
        
        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 80px auto 40px;
            padding: 0 20px;
        }
        
        /* Hero Section */
        .hero-section {
            background: white;
            border-radius: 20px;
            padding: 60px;
            margin-bottom: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            background-image: linear-gradient(135deg, rgba(102,126,234,0.05) 0%, rgba(118,75,162,0.05) 100%);
        }
        
        .hero-title {
            font-size: 3em;
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero-subtitle {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 40px;
        }
        
        /* Key Metrics Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border-top: 4px solid;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #2E3440;
            margin-bottom: 10px;
        }
        
        .metric-change {
            font-size: 0.95em;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .metric-change.positive {
            background: #e6fffa;
            color: #00875a;
        }
        
        .metric-change.negative {
            background: #ffebe6;
            color: #de350b;
        }
        
        /* Section Cards */
        .section-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 10px;
            color: #2E3440;
        }
        
        .section-subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        /* Visualization Container */
        .viz-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab.active {
            color: #667eea;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        /* Insights Box */
        .insights-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .insights-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .insights-list {
            list-style: none;
        }
        
        .insights-list li {
            padding: 10px 0;
            padding-left: 25px;
            position: relative;
        }
        
        .insights-list li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        /* Massachusetts Highlight */
        .ma-highlight {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 40px;
            color: white;
            margin-top: 60px;
        }
        
        /* Loading Spinner */
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2em;
            }
            
            .nav-links {
                display: none;
            }
            
            .hero-section {
                padding: 30px;
            }
            
            .section-card {
                padding: 20px;
            }
        }
        
        /* Print Styles */
        @media print {
            .nav-header {
                position: relative;
            }
            
            .container {
                margin-top: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-header">
        <div class="nav-content">
            <div class="logo">üìä Education Analytics Dashboard</div>
            <ul class="nav-links">
                <li><a onclick="scrollToSection('overview')">Overview</a></li>
                <li><a onclick="scrollToSection('performance')">Performance</a></li>
                <li><a onclick="scrollToSection('investment')">Investment</a></li>
                <li><a onclick="scrollToSection('insights')">Insights</a></li>
                <li><a onclick="downloadReport()">üì• Download Report</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Hero Section -->
        <div class="hero-section" id="overview">
            <h1 class="hero-title">US Education Performance Analysis</h1>
            <p class="hero-subtitle">Comprehensive analysis of state-level education outcomes, spending efficiency, and policy implications based on 2024 official government data</p>
            
            <!-- Key Metrics -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">National NAEP Average</div>
                    <div class="metric-value">274.7</div>
                    <span class="metric-change negative">-2.3 vs 2022</span>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Average Spending/Pupil</div>
                    <div class="metric-value">$15,395</div>
                    <span class="metric-change positive">+8.9% vs FY2021</span>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Top Performer</div>
                    <div class="metric-value">MA</div>
                    <span class="ma-highlight">NAEP: 288</span>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Best ROI State</div>
                    <div class="metric-value">Utah</div>
                    <span class="metric-change positive">1.66x efficiency</span>
                </div>
            </div>
        </div>

        <!-- Performance Analysis Section -->
        <div class="section-card" id="performance">
            <h2 class="section-title">üìà Performance Analysis</h2>
            <p class="section-subtitle">State-by-state comparison of educational outcomes and key performance indicators</p>
            
            <!-- Tabs for different views -->
            <div class="tabs">
                <button class="tab active" onclick="showPerformanceView('map')">Geographic View</button>
                <button class="tab" onclick="showPerformanceView('ranking')">State Rankings</button>
                <button class="tab" onclick="showPerformanceView('comparison')">Regional Analysis</button>
            </div>
            
            <div class="viz-container">
                <div id="performanceChart"></div>
            </div>
            
            <!-- Top Performers Table -->
            <h3 style="margin-top: 30px; margin-bottom: 15px;">Top 10 Performing States (2024 NAEP Mathematics)</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>State</th>
                        <th>NAEP Score</th>
                        <th>Spending/Pupil</th>
                        <th>Child Poverty Rate</th>
                        <th>ROI</th>
                    </tr>
                </thead>
                <tbody id="topPerformersTable">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Investment Efficiency Section -->
        <div class="section-card" id="investment">
            <h2 class="section-title">üí∞ Investment Efficiency Analysis</h2>
            <p class="section-subtitle">Understanding the relationship between education spending and outcomes</p>
            
            <div class="viz-container">
                <div id="roiChart"></div>
            </div>
            
            <div class="insights-box">
                <div class="insights-title">üîç Key Investment Insights</div>
                <ul class="insights-list">
                    <li>Utah achieves the highest ROI (1.66x) with the lowest per-pupil spending ($9,552)</li>
                    <li>New York spends the most per pupil ($29,873) but ranks 15th in NAEP scores</li>
                    <li>Massachusetts balances high spending ($21,524) with top performance (NAEP: 288)</li>
                    <li>States with poverty rates above 20% show significantly lower NAEP scores</li>
                    <li>Every $1,000 increase in per-pupil spending correlates with only 0.8-point NAEP gain</li>
                </ul>
            </div>
        </div>

        <!-- Massachusetts Spotlight Section -->
        <div class="section-card">
            <h2 class="section-title">‚≠ê Massachusetts: A Model for Excellence</h2>
            <p class="section-subtitle">Deep dive into the nation's top-performing education system</p>
            
            <div class="viz-container">
                <div id="massachusettsChart"></div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;">
                <div>
                    <h3>Performance Metrics</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 8px 0;">üìä NAEP Math Score: <strong>288</strong> (#1 nationally)</li>
                        <li style="padding: 8px 0;">üíµ Per-Pupil Spending: <strong>$21,524</strong></li>
                        <li style="padding: 8px 0;">üë∂ Child Poverty Rate: <strong>10.7%</strong></li>
                        <li style="padding: 8px 0;">üìà Education ROI: <strong>1.04x</strong></li>
                        <li style="padding: 8px 0;">üåç Est. PISA Equivalent: <strong>~520</strong> (Would rank #4 globally)</li>
                    </ul>
                </div>
                
                <div>
                    <h3>Success Factors</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 8px 0;">‚úÖ Strong state funding commitment</li>
                        <li style="padding: 8px 0;">‚úÖ Low child poverty rate</li>
                        <li style="padding: 8px 0;">‚úÖ High teacher standards & pay</li>
                        <li style="padding: 8px 0;">‚úÖ Comprehensive curriculum standards</li>
                        <li style="padding: 8px 0;">‚úÖ Early childhood education investment</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Policy Recommendations Section -->
        <div class="section-card" id="insights">
            <h2 class="section-title">üéØ Policy Recommendations</h2>
            <p class="section-subtitle">Evidence-based strategies for improving educational outcomes</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-top: 30px;">
                <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; border-left: 4px solid #667eea;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üìö For Low-Performing States</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 8px 0;">‚Ä¢ Increase per-pupil spending to at least $12,000</li>
                        <li style="padding: 8px 0;">‚Ä¢ Focus on reducing child poverty through integrated services</li>
                        <li style="padding: 8px 0;">‚Ä¢ Implement Massachusetts-style curriculum standards</li>
                        <li style="padding: 8px 0;">‚Ä¢ Invest in teacher training and retention programs</li>
                    </ul>
                </div>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; border-left: 4px solid #764ba2;">
                    <h3 style="color: #764ba2; margin-bottom: 15px;">üí° For High-Spending States</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 8px 0;">‚Ä¢ Audit spending efficiency and reduce administrative costs</li>
                        <li style="padding: 8px 0;">‚Ä¢ Implement performance-based funding models</li>
                        <li style="padding: 8px 0;">‚Ä¢ Focus resources on classroom instruction</li>
                        <li style="padding: 8px 0;">‚Ä¢ Study Utah's efficiency model for cost optimization</li>
                    </ul>
                </div>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; border-left: 4px solid #00875a;">
                    <h3 style="color: #00875a; margin-bottom: 15px;">üöÄ National Priorities</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 8px 0;">‚Ä¢ Establish minimum funding floor of $10,000/pupil</li>
                        <li style="padding: 8px 0;">‚Ä¢ Create interstate education compacts for best practices</li>
                        <li style="padding: 8px 0;">‚Ä¢ Develop targeted interventions for high-poverty areas</li>
                        <li style="padding: 8px 0;">‚Ä¢ Incentivize states to adopt proven curriculum models</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- International Context Section -->
        <div class="section-card">
            <h2 class="section-title">üåç International Context</h2>
            <p class="section-subtitle">How US education performance compares globally</p>
            
            <div class="viz-container">
                <div id="internationalChart"></div>
            </div>
        </div>

        <!-- Data Sources -->
        <div class="section-card" style="background: #f8f9fa;">
            <h2 class="section-title">üìä Data Sources & Methodology</h2>
            <p class="section-subtitle">All data from verified government sources</p>
            
            <ul style="list-style: none; padding: 0; margin-top: 20px;">
                <li style="padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                    <strong>NAEP Mathematics Scores:</strong> National Assessment of Educational Progress, 2024 Grade 8 Assessment
                    <br><small style="color: #666;">Source: National Center for Education Statistics</small>
                </li>
                <li style="padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                    <strong>Per-Pupil Spending:</strong> FY 2022 Annual Survey of School System Finances
                    <br><small style="color: #666;">Source: US Census Bureau</small>
                </li>
                <li style="padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                    <strong>Child Poverty Rates:</strong> 2023 Small Area Income and Poverty Estimates (SAIPE)
                    <br><small style="color: #666;">Source: US Census Bureau</small>
                </li>
                <li style="padding: 10px 0;">
                    <strong>International Comparison:</strong> PISA 2022 Mathematics Assessment
                    <br><small style="color: #666;">Source: Organisation for Economic Co-operation and Development (OECD)</small>
                </li>
            </ul>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>¬© 2024 Education Analytics Dashboard | Data current as of January 2025</p>
        <p style="margin-top: 10px; opacity: 0.8;">Prepared for stakeholder presentation | ML/AI Engineering Portfolio Project</p>
    </div>

    <script>
        // Real education data
        const educationData = {
            states: ['Massachusetts', 'Minnesota', 'New Hampshire', 'New Jersey', 'North Dakota', 
                     'Utah', 'Vermont', 'Wisconsin', 'South Dakota', 'Maine', 'Montana', 'Idaho',
                     'Indiana', 'Iowa', 'Kansas', 'Virginia', 'Wyoming', 'Ohio', 'Colorado', 'Texas',
                     'Pennsylvania', 'Connecticut', 'Oregon', 'New York', 'Delaware', 'Illinois',
                     'North Carolina', 'Missouri', 'Alaska', 'Rhode Island', 'Florida', 'Tennessee',
                     'South Carolina', 'Maryland', 'Kentucky', 'Arizona', 'Georgia', 'Michigan',
                     'Nevada', 'Oklahoma', 'Arkansas', 'Hawaii', 'Alabama', 'West Virginia',
                     'Louisiana', 'Mississippi', 'California', 'New Mexico', 'District of Columbia'],
            
            naepScores: [288, 286, 286, 285, 284, 283, 283, 283, 282, 282, 282, 280,
                         281, 280, 280, 282, 281, 279, 278, 278, 277, 277, 276, 275, 275, 275,
                         274, 274, 274, 271, 271, 271, 271, 271, 270, 270, 268, 268,
                         268, 268, 267, 268, 262, 265, 264, 264, 261, 259, 254],
            
            spending: [21524, 14752, 19698, 25099, 15265, 9552, 24608, 14031, 11476, 17310, 13206, 9670,
                      11945, 13404, 13537, 13634, 19136, 14532, 12638, 10886, 19124, 24453, 14989, 29873,
                      18866, 18316, 11312, 12775, 19553, 19558, 10586, 10958, 12973, 17590, 12833, 10315,
                      12764, 14413, 11215, 10890, 11948, 18611, 11503, 13602, 13538, 10984, 15831, 11596, 27425],
            
            povertyRates: [10.7, 9.3, 6.4, 10.2, 9.6, 8.1, 10.4, 11.6, 12.5, 12.1, 13.1, 11.6,
                          14.1, 11.1, 12.3, 11.0, 11.1, 17.0, 9.6, 18.4, 14.8, 11.8, 12.5, 17.0,
                          13.5, 14.4, 16.7, 15.4, 11.4, 13.6, 16.2, 17.4, 18.8, 10.1, 19.1, 17.0,
                          17.5, 16.5, 14.8, 18.7, 20.2, 10.3, 20.7, 20.8, 24.0, 25.1, 14.3, 21.9, 21.6],
            
            stateCodes: ['MA', 'MN', 'NH', 'NJ', 'ND', 'UT', 'VT', 'WI', 'SD', 'ME', 'MT', 'ID',
                        'IN', 'IA', 'KS', 'VA', 'WY', 'OH', 'CO', 'TX', 'PA', 'CT', 'OR', 'NY',
                        'DE', 'IL', 'NC', 'MO', 'AK', 'RI', 'FL', 'TN', 'SC', 'MD', 'KY', 'AZ',
                        'GA', 'MI', 'NV', 'OK', 'AR', 'HI', 'AL', 'WV', 'LA', 'MS', 'CA', 'NM', 'DC']
        };

        // Calculate ROI
        const nationalAvgNAEP = educationData.naepScores.reduce((a, b) => a + b, 0) / educationData.naepScores.length;
        const nationalAvgSpending = educationData.spending.reduce((a, b) => a + b, 0) / educationData.spending.length;
        
        educationData.roi = educationData.naepScores.map((score, i) => {
            const spending = educationData.spending[i];
            return ((score / nationalAvgNAEP) / (spending / nationalAvgSpending)).toFixed(2);
        });

        // Initialize dashboard
        function initDashboard() {
            createPerformanceMap();
            createROIScatter();
            createMassachusettsComparison();
            createInternationalComparison();
            populateTopPerformersTable();
        }

        // Create choropleth map
        function createPerformanceMap() {
            const data = [{
                type: 'choropleth',
                locationmode: 'USA-states',
                locations: educationData.stateCodes,
                z: educationData.naepScores,
                text: educationData.states,
                hovertemplate: '<b>%{text}</b><br>NAEP Score: %{z}<br><extra></extra>',
                colorscale: 'RdYlGn',
                colorbar: {
                    title: 'NAEP Score',
                    thickness: 15
                }
            }];
            
            const layout = {
                title: 'NAEP Mathematics Scores by State (2024)',
                geo: {
                    scope: 'usa',
                    projection: { type: 'albers usa' },
                    showlakes: true,
                    lakecolor: 'rgb(190, 190, 255)'
                },
                height: 500,
                margin: { t: 50, b: 0, l: 0, r: 0 }
            };
            
            Plotly.newPlot('performanceChart', data, layout, {responsive: true});
        }

        // Create ROI scatter plot
        function createROIScatter() {
            const trace = {
                x: educationData.spending,
                y: educationData.naepScores,
                mode: 'markers+text',
                marker: {
                    size: educationData.roi.map(r => parseFloat(r) * 15),
                    color: educationData.povertyRates,
                    colorscale: 'RdYlGn_r',
                    showscale: true,
                    colorbar: {
                        title: 'Poverty Rate (%)',
                        x: 1.02
                    }
                },
                text: educationData.states.map(s => s === 'Massachusetts' ? s : ''),
                textposition: 'top center',
                hovertemplate: '<b>%{hovertext}</b><br>' +
                              'Spending: $%{x:,.0f}<br>' +
                              'NAEP Score: %{y}<br>' +
                              'Poverty Rate: %{marker.color:.1f}%<br>' +
                              '<extra></extra>',
                hovertext: educationData.states
            };
            
            const layout = {
                title: 'Education Spending vs Performance: Return on Investment Analysis',
                xaxis: {
                    title: 'Per-Pupil Spending ($)',
                    tickformat: '$,.0f'
                },
                yaxis: {
                    title: 'NAEP Math Score'
                },
                height: 500,
                annotations: [{
                    x: 21524,
                    y: 288,
                    text: 'Massachusetts<br>Top Performer',
                    showarrow: true,
                    arrowhead: 2,
                    bgcolor: 'gold',
                    bordercolor: 'black',
                    borderwidth: 1
                }]
            };
            
            Plotly.newPlot('roiChart', [trace], layout, {responsive: true});
        }

        // Create Massachusetts comparison
        function createMassachusettsComparison() {
            const maIndex = educationData.states.indexOf('Massachusetts');
            const categories = ['NAEP Score', 'Spending ($100s)', 'Poverty Rate'];
            
            const maValues = [
                educationData.naepScores[maIndex],
                educationData.spending[maIndex] / 100,
                educationData.povertyRates[maIndex]
            ];
            
            const nationalValues = [
                nationalAvgNAEP,
                nationalAvgSpending / 100,
                educationData.povertyRates.reduce((a, b) => a + b, 0) / educationData.povertyRates.length
            ];
            
            const trace1 = {
                x: categories,
                y: maValues,
                name: 'Massachusetts',
                type: 'bar',
                marker: { color: 'gold' }
            };
            
            const trace2 = {
                x: categories,
                y: nationalValues,
                name: 'National Average',
                type: 'bar',
                marker: { color: 'lightblue' }
            };
            
            const layout = {
                title: 'Massachusetts vs National Average',
                barmode: 'group',
                height: 400
            };
            
            Plotly.newPlot('massachusettsChart', [trace1, trace2], layout, {responsive: true});
        }

        // Create international comparison
        function createInternationalComparison() {
            const countries = ['Singapore', 'China (Select)', 'Taiwan', 'Hong Kong', 'Japan', 
                             'Korea', 'Massachusetts (Est.)', 'Estonia', 'Switzerland', 'Canada',
                             'Netherlands', 'Belgium', 'United Kingdom', 'United States'];
            const scores = [575, 591, 547, 540, 536, 527, 520, 510, 508, 497, 493, 489, 489, 465];
            
            const trace = {
                x: scores,
                y: countries,
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: countries.map(c => c.includes('Massachusetts') ? 'gold' : 
                                             c === 'United States' ? 'lightcoral' : 'steelblue')
                }
            };
            
            const layout = {
                title: 'PISA 2022 Mathematics: International Comparison',
                xaxis: { title: 'PISA Mathematics Score' },
                height: 500,
                margin: { l: 120 }
            };
            
            Plotly.newPlot('internationalChart', [trace], layout, {responsive: true});
        }

        // Populate top performers table
        function populateTopPerformersTable() {
            const tableBody = document.getElementById('topPerformersTable');
            
            for (let i = 0; i < 10; i++) {
                const row = `
                    <tr ${educationData.states[i] === 'Massachusetts' ? 'style="background: #fffacd;"' : ''}>
                        <td>${i + 1}</td>
                        <td>${educationData.states[i] === 'Massachusetts' ? '<span class="ma-highlight">Massachusetts</span>' : educationData.states[i]}</td>
                        <td>${educationData.naepScores[i]}</td>
                        <td>$${educationData.spending[i].toLocaleString()}</td>
                        <td>${educationData.povertyRates[i]}%</td>
                        <td>${educationData.roi[i]}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            }
        }

        // View switching functions
        function showPerformanceView(view) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            if (view === 'map') {
                createPerformanceMap();
            } else if (view === 'ranking') {
                createRankingChart();
            } else if (view === 'comparison') {
                createRegionalComparison();
            }
        }

        function createRankingChart() {
            const top20States = educationData.states.slice(0, 20);
            const top20Scores = educationData.naepScores.slice(0, 20);
            
            const trace = {
                x: top20Scores,
                y: top20States,
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: top20States.map(s => s === 'Massachusetts' ? 'gold' : 'steelblue')
                }
            };
            
            const layout = {
                title: 'Top 20 States by NAEP Mathematics Score',
                xaxis: { title: 'NAEP Score' },
                height: 500,
                margin: { l: 120 }
            };
            
            Plotly.newPlot('performanceChart', [trace], layout, {responsive: true});
        }

        function createRegionalComparison() {
            // Group states by region
            const regions = {
                'Northeast': ['MA', 'NH', 'VT', 'ME', 'CT', 'RI', 'NY', 'NJ', 'PA'],
                'Midwest': ['MN', 'WI', 'IA', 'IL', 'IN', 'OH', 'MI', 'MO', 'KS', 'NE', 'SD', 'ND'],
                'South': ['MD', 'DE', 'DC', 'VA', 'WV', 'KY', 'TN', 'NC', 'SC', 'GA', 'FL', 'AL', 'MS', 'LA', 'AR', 'TX', 'OK'],
                'West': ['CA', 'OR', 'WA', 'ID', 'NV', 'UT', 'AZ', 'NM', 'CO', 'WY', 'MT', 'AK', 'HI']
            };
            
            const regionScores = {};
            for (const [region, codes] of Object.entries(regions)) {
                const scores = codes.map(code => {
                    const idx = educationData.stateCodes.indexOf(code);
                    return idx !== -1 ? educationData.naepScores[idx] : null;
                }).filter(s => s !== null);
                
                regionScores[region] = {
                    avg: scores.reduce((a, b) => a + b, 0) / scores.length,
                    max: Math.max(...scores),
                    min: Math.min(...scores)
                };
            }
            
            const trace = {
                x: Object.keys(regionScores),
                y: Object.values(regionScores).map(r => r.avg),
                type: 'bar',
                marker: { color: ['#667eea', '#764ba2', '#f67280', '#c06c84'] },
                text: Object.values(regionScores).map(r => `Avg: ${r.avg.toFixed(1)}`),
                textposition: 'outside'
            };
            
            const layout = {
                title: 'Regional Performance Comparison',
                yaxis: { title: 'Average NAEP Score' },
                height: 500
            };
            
            Plotly.newPlot('performanceChart', [trace], layout, {responsive: true});
        }

        // Scroll to section
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
        }

        // Download report function
        function downloadReport() {
            const reportContent = `
US EDUCATION PERFORMANCE REPORT
================================
Generated: ${new Date().toLocaleDateString()}

EXECUTIVE SUMMARY
-----------------
‚Ä¢ National NAEP Average: 274.7
‚Ä¢ Average Per-Pupil Spending: $15,395
‚Ä¢ Top Performer: Massachusetts (NAEP: 288)
‚Ä¢ Best ROI: Utah (1.66x efficiency)

TOP 10 PERFORMING STATES
------------------------
1. Massachusetts - NAEP: 288
2. Minnesota - NAEP: 286
3. New Hampshire - NAEP: 286
4. New Jersey - NAEP: 285
5. North Dakota - NAEP: 284
6. Utah - NAEP: 283
7. Vermont - NAEP: 283
8. Wisconsin - NAEP: 283
9. South Dakota - NAEP: 282
10. Maine - NAEP: 282

DATA SOURCES
------------
‚Ä¢ NAEP 2024 Mathematics Assessment
‚Ä¢ US Census Bureau FY 2022
‚Ä¢ SAIPE 2023
‚Ä¢ OECD PISA 2022
            `;
            
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'education_performance_report.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Initialize on load
        window.onload = function() {
            initDashboard();
        };
    </script>
</body>
</html>